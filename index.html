<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>One-Click Geo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="/static/manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/static/service-worker.js')
        .then(() => console.log("Service Worker registrado"))
        .catch(err => console.error("Erro no Service Worker:", err));
    }
  </script>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    .card { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 400px; width: 100%; text-align: center; }
    button { padding: 0.8rem 1.2rem; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; margin-top: 1rem; }
    #sendBtn { background: green; color: white; }
    #rescueBtn { background: red; color: white; }
    .error { color: red; margin-top: 1rem; }
    .success { color: green; margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="card">
    <h2>One-Click Geo</h2>
    <p id="status">Buscando localiza√ß√£o...</p>
    <button id="sendBtn" style="display: none;">Enviar pelo WhatsApp</button>
    <button id="rescueBtn" style="display: none;">Solicitar Resgate!</button>
    <p id="feedback"></p>
  </div>

  <script>
    const statusEl = document.getElementById("status");
    const sendBtn = document.getElementById("sendBtn");
    const rescueBtn = document.getElementById("rescueBtn");
    const feedbackEl = document.getElementById("feedback");
    let coords = null;

    function showMessage(message, type="") {
      feedbackEl.textContent = message;
      feedbackEl.className = type;
    }

    function fetchLocation() {
      if (!navigator.geolocation) {
        statusEl.textContent = "Geolocaliza√ß√£o n√£o √© suportada pelo seu navegador.";
        showMessage("Erro: recurso n√£o suportado.", "error");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          coords = position.coords;
          const lat = coords.latitude.toFixed(4);
          const lng = coords.longitude.toFixed(4);
          statusEl.textContent = `Latitude: ${lat}, Longitude: ${lng}`;
          sendBtn.style.display = "inline-block";
          rescueBtn.style.display = "inline-block";
          showMessage("Localiza√ß√£o obtida com sucesso!", "success");
        },
        (error) => {
          statusEl.textContent = "Erro ao obter localiza√ß√£o.";
          showMessage("Erro: Permita acesso √† localiza√ß√£o no Safari e recarregue a p√°gina.", "error");
        }
      );
    }

    function sendWhatsApp(message) {
      const waUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
      window.open(waUrl, "_blank");
    }

    sendBtn.addEventListener("click", () => {
      if (!coords) return showMessage("Coordenadas n√£o dispon√≠veis.", "error");
      const msg = `Minhas coordenadas s√£o: Latitude ${coords.latitude.toFixed(4)}, Longitude ${coords.longitude.toFixed(4)}. https://www.google.com/maps?q=${coords.latitude},${coords.longitude}`;
      sendWhatsApp(msg);
      showMessage("Abrindo WhatsApp...", "success");
    });

    rescueBtn.addEventListener("click", () => {
      if (!coords) return showMessage("Coordenadas n√£o dispon√≠veis.", "error");
      if (!confirm("Voc√™ tem certeza de que quer solicitar resgate?")) return;
      const msg = `üö® SOLICITA√á√ÉO DE RESGATE üö®
Localiza√ß√£o: Latitude ${coords.latitude.toFixed(4)}, Longitude ${coords.longitude.toFixed(4)}.
https://www.google.com/maps?q=${coords.latitude},${coords.longitude}`;
      sendWhatsApp(msg);
      showMessage("Solicita√ß√£o de resgate enviada!", "success");
    });

    fetchLocation();
  </script>
</body>
</html>
